<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="é£²æ–™é›²ç«¯ç‰ˆ">
    <title>é£²æ–™è¨˜éŒ„å°å¹«æ‰‹(é›²ç«¯)</title>
    <style>
        /* æ¨£å¼ä¿æŒä¸è®Š */
        :root { --primary: #C7B299; --primary-text: #4A403A; --green: #558B6E; --gold: #D4A017; --bg: #F5F1ED; --card-bg: #ffffff; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: var(--bg); margin: 0; padding: 20px; padding-bottom: 50px; color: #4A403A; }
        .container { max-width: 500px; margin: 0 auto; }
        .stats-card { background: var(--primary); color: var(--primary-text); padding: 20px; border-radius: 15px; display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 20px; box-shadow: 0 4px 10px rgba(199, 178, 153, 0.3); }
        .stat-item { text-align: center; }
        .stat-val { font-size: 1.4em; font-weight: bold; }
        .stat-label { font-size: 0.8em; opacity: 0.8; margin-top: 5px; font-weight: 500;}
        .eco-stat .stat-val, .eco-stat .stat-label { color: #2c5e42; }
        .gift-stat { color: #4A403A; font-size: 0.7em; margin-top: 5px; opacity: 0.9; }
        .input-group { background: var(--card-bg); padding: 20px; border-radius: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); border: 1px solid #E8E0D9;}
        input[type="date"], input[type="text"], input[type="number"], select { width: 100%; padding: 12px; margin-bottom: 12px; border: 1px solid #DBC4A9; border-radius: 8px; box-sizing: border-box; background-color: #FFFCF9; color: #5D534A; outline: none; font-family: inherit; font-size: 1em; -webkit-appearance: none; }
        input[type="date"] { display: block; }
        input:focus, select:focus { border-color: var(--primary); }
        .options-row { display: flex; gap: 15px; margin-bottom: 20px; }
        .checkbox-wrapper { flex: 1; display: flex; align-items: center; padding: 10px; cursor: pointer; background: #FFFCF9; border: 1px solid #DBC4A9; border-radius: 8px; }
        .checkbox-wrapper:active { background: #FDF5EE; }
        .checkbox-wrapper input { width: auto; margin: 0 8px 0 0; transform: scale(1.2); cursor: pointer; accent-color: var(--green); }
        .checkbox-wrapper label { cursor: pointer; font-weight: 500; color: #5D534A; font-size: 0.95em; flex-grow: 1;}
        .checkbox-wrapper.gift-wrapper input { accent-color: var(--gold); }
        .eco-tag { color: var(--green); font-size: 0.8em; font-weight: bold;}
        .gift-tag { color: var(--gold); font-size: 0.8em; font-weight: bold;}
        button { width: 100%; background: var(--primary); color: var(--primary-text); border: none; padding: 15px; border-radius: 8px; font-size: 1em; cursor: pointer; font-weight: bold; transition: 0.2s; box-shadow: 0 3px 6px rgba(199, 178, 153, 0.2); }
        button:hover { background: #BFA88E; }
        button:active { transform: scale(0.98); box-shadow: none; }
        button:disabled { background: #ccc; cursor: not-allowed; }
        h3 { margin-top: 30px; color: #7D7065; font-weight: 600; display: flex; justify-content: space-between; align-items: center; }
        .loading-text { font-size: 0.8em; color: #999; font-weight: normal; display: none; }
        .drink-list { list-style: none; padding: 0; }
        .drink-item { background: var(--card-bg); padding: 15px; border-radius: 12px; margin-bottom: 12px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.03); animation: fadeIn 0.3s ease; position: relative; overflow: hidden; border: 1px solid #F0EAE5;}
        .drink-item.is-eco { border-left: 5px solid var(--green); }
        .drink-item.is-gift { border-left: 5px solid var(--gold); background-color: #FFFDF5; }
        .drink-item.is-eco.is-gift { border-left-width: 5px; border-left-style: solid; border-image: linear-gradient(to bottom, var(--green), var(--gold)) 1 100%; }
        .drink-info h4 { margin: 0 0 6px 0; font-size: 1.1em; display: flex; align-items: center; color: #4A403A; flex-wrap: wrap; gap: 5px;}
        .badge { font-size: 0.75em; padding: 3px 7px; border-radius: 6px; font-weight: bold; display: inline-block;}
        .badge-eco { background: #E3F0E9; color: var(--green); }
        .badge-gift { background: #FFF3CD; color: #856404; }
        .drink-detail { font-size: 0.85em; color: #9C8E83; }
        .drink-price-group { text-align: right; }
        .drink-price { font-weight: bold; color: #8C7B65; font-size: 1.2em; }
        .drink-original-price { font-size: 0.75em; color: #bbb; text-decoration: line-through; display: block;}
        .delete-btn { background: #E6C9C9; color: #A85555; border: none; border-radius: 6px; padding: 6px 12px; font-size: 0.8em; margin-left: 12px; cursor: pointer; box-shadow: none; width: auto;}
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<div class="container">
    <div class="stats-card">
        <div class="stat-item">
            <div class="stat-val" id="totalCount">...</div>
            <div class="stat-label">ç´¯ç©æ¯æ•¸</div>
        </div>
        <div class="stat-item">
            <div class="stat-val">$<span id="totalCost">...</span></div>
            <div class="stat-label">è‡ªå·±èŠ±è²»
                <div class="gift-stat" id="giftStat"></div>
            </div>
        </div>
        <div class="stat-item eco-stat">
            <div class="stat-val">$<span id="totalSaved">...</span></div>
            <div class="stat-label">ğŸŒ¿ç’°ä¿çœä¸‹</div>
        </div>
    </div>

    <div class="input-group">
        <label style="font-size: 0.85em; color: #7D7065; margin-left: 2px; margin-bottom: 5px; display:block;">è³¼è²·æ—¥æœŸ</label>
        <input type="date" id="recordDate" />

        <input type="text" id="shopName" list="shopList" placeholder="åº—å®¶åç¨± (ä¾‹å¦‚: å„’è¨˜)" />
        <datalist id="shopList"></datalist>

        <input type="text" id="drinkName" list="drinkList" placeholder="é£²æ–™å“é … (ä¾‹å¦‚: ç´…èŒ¶æ‹¿éµ)" />
        <datalist id="drinkList"></datalist>

        <div style="display: flex; gap: 10px;">
            <select id="sugar">
                <option value="å…¨ç³–">å…¨ç³–</option>
                <option value="å°‘ç³–">å°‘ç³–</option>
                <option value="åŠç³–">åŠç³–</option>
                <option value="å¾®ç³–">å¾®ç³–</option>
                <option value="å…©åˆ†ç³–">å…©åˆ†ç³–</option>
                <option value="ä¸€åˆ†ç³–">ä¸€åˆ†ç³–</option>
                <option value="ç„¡ç³–">ç„¡ç³–</option>
            </select>
            <select id="ice">
                <option value="æ­£å¸¸å†°">æ­£å¸¸å†°</option>
                <option value="å°‘å†°">å°‘å†°</option>
                <option value="å¾®å†°">å¾®å†°</option>
                <option value="å»å†°">å»å†°</option>
                <option value="ç†±">ç†±</option>
            </select>
        </div>
        
        <input type="number" id="price" placeholder="è«‹è¼¸å…¥é£²æ–™åŸåƒ¹" />
        
        <div class="options-row">
            <div class="checkbox-wrapper" onclick="toggleEco()">
                <input type="checkbox" id="isEco" onclick="event.stopPropagation()">
                <label for="isEco">ç’°ä¿æ¯</label>
                <span class="eco-tag">çœ$5</span>
            </div>
            <div class="checkbox-wrapper gift-wrapper" onclick="toggleGift()">
                <input type="checkbox" id="isGift" onclick="event.stopPropagation()">
                <label for="isGift">åˆ¥äººè«‹å®¢</label>
                <span class="gift-tag">å…è²»</span>
            </div>
        </div>

        <button id="submitBtn" onclick="addDrink()">ï¼‹ è¨˜éŒ„ä¸€æ¯</button>
    </div>

    <h3>æœ€è¿‘å–äº†ä»€éº¼... <span id="loading" class="loading-text">è³‡æ–™åŒæ­¥ä¸­...</span></h3>
    <ul class="drink-list" id="list"></ul>
    
    </div>

<script>
    // ã€âš ï¸ é‡è¦ï¼šè«‹è¨˜å¾—æŠŠä¸‹é¢é€™ä¸²æ›æˆä½ çš„ Google Apps Script ç¶²å€ âš ï¸ã€‘
    const API_URL = "è«‹æŠŠä½ çš„GoogleAppsScriptç¶²å€è²¼åœ¨é€™è£¡";

    let drinks = [];
    
    // åˆå§‹åŒ–
    const today = new Date();
    const year = today.getFullYear();
    const month = String(today.getMonth() + 1).padStart(2, '0');
    const day = String(today.getDate()).padStart(2, '0');
    document.getElementById('recordDate').value = `${year}-${month}-${day}`;
    
    // ç¨‹å¼ä¸€å•Ÿå‹•ï¼Œç«‹åˆ»æŠ“è³‡æ–™
    fetchData();

    function toggleEco() {
        const cb = document.getElementById('isEco');
        cb.checked = !cb.checked;
    }
    
    function toggleGift() {
        const cb = document.getElementById('isGift');
        cb.checked = !cb.checked;
    }

    // å¾é›²ç«¯æŠ“è³‡æ–™
    function fetchData() {
        showLoading(true);
        fetch(API_URL)
            .then(response => response.json())
            .then(data => {
                drinks = data;
                render();
                showLoading(false);
            })
            .catch(error => {
                alert("è®€å–å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯æˆ–ç¶²å€ï¼");
                showLoading(false);
                console.error(error);
            });
    }

    function addDrink() {
        const dateInput = document.getElementById('recordDate').value;
        const shop = document.getElementById('shopName').value;
        const name = document.getElementById('drinkName').value;
        let price = parseInt(document.getElementById('price').value);
        const sugar = document.getElementById('sugar').value;
        const ice = document.getElementById('ice').value;
        const isEco = document.getElementById('isEco').checked;
        const isGift = document.getElementById('isGift').checked;

        if (!shop || !name || isNaN(price) || !dateInput) {
            alert("è«‹å¡«å¯«å®Œæ•´è³‡è¨Šå–”ï¼");
            return;
        }

        const displayDate = dateInput.replace(/-/g, '/');
        const newDrink = {
            id: Date.now(),
            date: displayDate,
            shop, name, price, sugar, ice, isEco, isGift
        };

        // UI å…ˆå‡è£æ–°å¢æˆåŠŸ
        drinks.unshift(newDrink);
        render();
        
        // å‚³é€çµ¦å¾Œç«¯
        showLoading(true, "å„²å­˜ä¸­...");
        const btn = document.getElementById('submitBtn');
        btn.disabled = true;
        btn.textContent = "â˜ï¸ é›²ç«¯å¯«å…¥ä¸­...";

        fetch(API_URL, {
            method: 'POST',
            mode: 'no-cors', 
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(newDrink)
        }).then(() => {
            showLoading(false);
            btn.disabled = false;
            btn.textContent = "ï¼‹ è¨˜éŒ„ä¸€æ¯";
            
            // æ¸…ç©ºè¼¸å…¥
            document.getElementById('shopName').value = '';
            document.getElementById('drinkName').value = '';
            document.getElementById('price').value = '';
            document.getElementById('isEco').checked = false;
            document.getElementById('isGift').checked = false;
        }).catch(err => {
            alert("ä¸Šå‚³å¤±æ•— QQ");
            btn.disabled = false;
            btn.textContent = "ï¼‹ è¨˜éŒ„ä¸€æ¯";
        });
    }

    function deleteDrink(id) {
        if(!confirm('ç¢ºå®šè¦åˆªé™¤é€™ç­†è¨˜éŒ„å—ï¼Ÿ(ä¹Ÿæœƒå¾è©¦ç®—è¡¨åˆªé™¤)')) return;

        drinks = drinks.filter(drink => drink.id != id);
        render();

        showLoading(true, "åˆªé™¤ä¸­...");
        fetch(API_URL, {
            method: 'POST',
            mode: 'no-cors',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ action: "delete", id: id })
        }).then(() => {
            showLoading(false);
        });
    }

    function showLoading(show, text="è³‡æ–™åŒæ­¥ä¸­...") {
        const el = document.getElementById('loading');
        el.textContent = text;
        el.style.display = show ? 'inline-block' : 'none';
    }

    function updateSuggestions() {
        const shops = [...new Set(drinks.map(d => d.shop))];
        const names = [...new Set(drinks.map(d => d.name))];
        document.getElementById('shopList').innerHTML = shops.map(s => `<option value="${s}">`).join('');
        document.getElementById('drinkList').innerHTML = names.map(n => `<option value="${n}">`).join('');
    }

    function render() {
        const list = document.getElementById('list');
        const totalCountEl = document.getElementById('totalCount');
        const totalCostEl = document.getElementById('totalCost');
        const totalSavedEl = document.getElementById('totalSaved');
        const giftStatEl = document.getElementById('giftStat');
        
        updateSuggestions();
        
        list.innerHTML = '';
        let totalCost = 0;
        let ecoSavings = 0;
        let giftValue = 0;

        // æ’åº
        const sortedDrinks = [...drinks].sort((a, b) => {
            const idA = typeof a.id === 'number' ? a.id : 0;
            const idB = typeof b.id === 'number' ? b.id : 0;
            return idB - idA;
        });

        sortedDrinks.forEach(drink => {
            const isGift = (drink.isGift === true || drink.isGift === "TRUE" || drink.isGift === "true");
            const isEco = (drink.isEco === true || drink.isEco === "TRUE" || drink.isEco === "true");
            
            // æ—¥æœŸä¿®å¾©é‚è¼¯
            let displayDate = drink.date;
            const dateObj = new Date(drink.date);
            if (!isNaN(dateObj.getTime())) {
                const year = dateObj.getFullYear();
                const month = String(dateObj.getMonth() + 1).padStart(2, '0');
                const day = String(dateObj.getDate()).padStart(2, '0');
                displayDate = `${year}/${month}/${day}`;
            }

            if (isGift) {
                giftValue += parseInt(drink.price);
            } else {
                totalCost += parseInt(drink.price);
                if (isEco) ecoSavings += 5;
            }

            const li = document.createElement('li');
            let classNames = 'drink-item';
            if (isEco) classNames += ' is-eco';
            if (isGift) classNames += ' is-gift';
            li.className = classNames;
            
            let badges = '';
            if (isEco) badges += '<span class="badge badge-eco">ğŸŒ¿ç’°ä¿æ¯</span> ';
            if (isGift) badges += '<span class="badge badge-gift">ğŸ‰å°ç¢ºå¹¸</span> ';
            
            let priceDisplay = '';
            if (isGift) {
                priceDisplay = `<div class="drink-price-group"><span class="drink-original-price">åŸåƒ¹$${drink.price}</span><div class="drink-price">$0</div></div>`;
            } else {
                priceDisplay = `<div class="drink-price">$${drink.price}</div>`;
            }

            li.innerHTML = `
                <div class="drink-info">
                    <h4>${drink.shop} - ${drink.name} ${badges}</h4>
                    <span class="drink-detail">${displayDate} | ${drink.sugar} / ${drink.ice}</span>
                </div>
                <div style="display:flex; align-items:center;">
                    ${priceDisplay}
                    <button class="delete-btn" onclick="deleteDrink(${drink.id})">âœ•</button>
                </div>
            `;
            list.appendChild(li);
        });

        totalCountEl.textContent = drinks.length;
        totalCostEl.textContent = totalCost;
        totalSavedEl.textContent = ecoSavings;
        giftStatEl.textContent = giftValue > 0 ? `(è³ºåˆ° $${giftValue})` : '';
    }
</script>

</body>
</html>

</body>
</html>


